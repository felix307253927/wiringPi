<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>client</title>
</head>
<body>
方向键发送命令
<input id="speed" type="text" value="30">

<script src="socket.io_client.js"></script>
<script>
  let speed = document.getElementById('speed');
  speed.onblur = function () {
      ws.emit('motor', 'speed', speed.value)
  }

//  const ws = io.connect('ws://192.168.1.109:8086')
  const ws = io.connect('ws://192.168.1.108:8086')
  let _timer, keyPress = {};

  function getCmd() {
      let cmd ='';
      if(keyPress[38]){
          cmd = 'F'
      } else if(keyPress[40]){
          cmd = 'B'
      }
      if(keyPress[37]){
          cmd+='L'
      } else if(keyPress[39]){
          cmd+='R'
      }
      return cmd
  }

  ws.on('connect', function () {
    console.log('connect')
      clearInterval(_timer)
      _timer = setInterval(function () {
          let cmd = getCmd();
          if(cmd){
              ws.emit('motor', cmd)
          }
      }, 0)
  })

  ws.on('disconnect', function () {
      clearInterval(_timer)
  })

  ws.on('error', function () {
      clearInterval(_timer)
  })

  ws.on('message',function(data){
      console.log(data);
  })

  document.body.addEventListener('keydown',function ({keyCode}) {
      if(keyCode>=37 && keyCode<=40){
          keyPress[keyCode] = true;
      }
  }, true)
  document.body.addEventListener('keyup',function ({keyCode}) {
      if(keyCode>=37 && keyCode<=40){
          keyPress[keyCode] = false;
          if(!getCmd()){
              console.log('stop')
              ws.emit('motor', 'stop')
          }
      }
  })
</script>
</body>
</html>